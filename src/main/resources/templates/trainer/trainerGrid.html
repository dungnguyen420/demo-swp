<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đội ngũ Huấn luyện viên - GymCare</title>

    <link rel="stylesheet" href="style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>

<header class="navbar">
    <a href="/home" class="logo">GymCare</a>
    <nav>
        <ul>
            <li><a href="/home">Trang chủ</a></li>
            <li><a href="/packages">Gói tập</a></li>
            <li><a href="/trainers">Huấn luyện viên</a></li>
            <li><a href="/classes">Lớp học</a></li>
            <li><a href="/shop" class="nav-button">Cửa hàng</a></li>
        </ul>
    </nav>
    <div class="auth-section">
    </div>
    <div class="auth-section">
        <div sec:authorize="isAuthenticated()" class="profile-dropdown">
            <img th:src="@{/images/default-avatar.png}" alt="Avatar">
            <span sec:authentication="principal.username">Username</span>
            <ul class="dropdown-menu">
                <li><a th:href="@{/profile}"><i class="fas fa-user-circle"></i> Hồ sơ cá nhân</a></li>
                <li class="logout"><a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a></li>
            </ul>
        </div>
        <a sec:authorize="!isAuthenticated()" th:href="@{/login}" class="cta-button">Đăng nhập</a>
    </div>
</header>

<main class="page-container">

    <div class="page-header">
        <h1 class="page-title">Huấn Luyện Viên</h1>
        <a  sec:authorize="hasAuthority('ROLE_ADMIN')" th:href="@{/trainers/create}" class="cta-button">
            <i class="fas fa-plus"></i> Tạo mới
        </a>
    </div>

    <div class="filter-container">
        <form th:action="@{/trainers}" method="get" class="filter-form">
            <input type="text" name="name" placeholder="Tìm theo tên HLV..." th:value="${name}">
            <select name="gender">
                <option value="">Tất cả giới tính</option>
                <option value="MALE" th:selected="${gender == T(com.example.swp.Enums.UserGender).MALE}">Nam</option>
                <option value="FEMALE" th:selected="${gender == T(com.example.swp.Enums.UserGender).FEMALE}">Nữ</option>
            </select>
            <input type="text" name="specialization" placeholder="Tìm theo chuyên môn..." th:value="${specialization}">
            <button type="submit">
                <i class="fas fa-search"></i> Lọc
            </button>
            <a th:href="@{/trainers}" class="btn-reset">Xóa bộ lọc</a>
        </form>

        <div class="quick-filters">
            <a th:href="@{/trainers(gender='MALE')}" class="btn-chip">Chỉ Nam</a>
            <a th:href="@{/trainers(gender='FEMALE')}" class="btn-chip">Chỉ Nữ</a>
            <a th:href="@{/trainers(specialization='Yoga')}" class="btn-chip">Yoga</a>
            <a th:href="@{/trainers(specialization='Bodybuilding')}" class="btn-chip">Bodybuilding</a>
        </div>
    </div>

    <div class="trainer-grid">
        <div class="trainer-card" th:each="trainer : ${trainers}">
            <a th:href="@{/trainers/detail/{id}(id=${trainer.id})}">
                <div class="trainer-image">
                    <img th:src="${trainer.avatar != null ? trainer.avatar : 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?q=80&w=2070&auto=format&fit=crop'}"
                         th:alt="${trainer.firstName}">
                </div>
                <div class="trainer-info">
                    <h3 th:text="${trainer.firstName + ' ' + trainer.lastName}">Tên HLV</h3>
                    <p class="specialization" th:text="${trainer.trainerProfile?.specialization} ?: 'Chưa cập nhật'"></p>
                    <p class="bio" th:text="${#strings.abbreviate(trainer.bio, 70)} ?: 'Chưa có thông tin giới thiệu.'"></p>
                </div>
            </a>
            <div class="card-actions" sec:authorize="hasAuthority('ROLE_ADMIN')">
                <a th:href="@{/trainers/edit/{id}(id=${trainer.id})}" class="action-btn edit">
                    <i class="fas fa-pencil-alt"></i> Sửa
                </a>
                <a th:href="@{/trainers/delete/{id}(id=${trainer.id})}" class="action-btn delete-trigger">
                    <i class="fas fa-trash-alt"></i> Xóa
                </a>
            </div>
        </div>

        <div th:if="${trainers == null or trainers.isEmpty()}">
            <h3>Không tìm thấy huấn luyện viên nào phù hợp.</h3>
        </div>
    </div>

    <div class="pagination" th:if="${totalPages > 1}">
        <a th:if="${currentPage > 0}" th:href="@{/trainers(name=${name}, gender=${gender}, page=${currentPage - 1})}" class="btn-chip">
            <i class="fas fa-chevron-left"></i> Trước
        </a>
        <span>Trang <span th:text="${currentPage + 1}"></span>/<span th:text="${totalPages}"></span></span>
        <a th:if="${currentPage + 1 < totalPages}" th:href="@{/trainers(name=${name}, gender=${gender}, page=${currentPage + 1})}" class="btn-chip">
            Sau <i class="fas fa-chevron-right"></i>
        </a>
    </div>

</main>

<div id="custom-popup" class="popup-overlay" style="display: none;">
    <div class="popup-content">
        <p>Bạn có chắc chắn muốn xóa huấn luyện viên này không?</p>
        <div class="popup-actions">
            <button id="confirm-delete-btn" class="action-btn confirm-delete">Xác nhận</button>
            <button id="cancel-delete-btn" class="action-btn cancel-delete">Hủy bỏ</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const popup = document.getElementById('custom-popup');
        if (!popup) return; // Dừng nếu không có popup trên trang

        const confirmBtn = document.getElementById('confirm-delete-btn');
        const cancelBtn = document.getElementById('cancel-delete-btn');
        const deleteLinks = document.querySelectorAll('.delete-trigger');
        let deleteUrl = '';

        deleteLinks.forEach(link => {
            link.addEventListener('click', function (event) {
                event.preventDefault();
                deleteUrl = this.href;
                popup.style.display = 'flex';
            });
        });

        confirmBtn.addEventListener('click', function () {
            if (deleteUrl) {
                window.location.href = deleteUrl;
            }
        });

        function closePopup() {
            popup.style.display = 'none';
        }

        cancelBtn.addEventListener('click', closePopup);
        popup.addEventListener('click', function(event) {
            if (event.target === popup) {
                closePopup();
            }
        });
    });
</script>

</body>
</html>