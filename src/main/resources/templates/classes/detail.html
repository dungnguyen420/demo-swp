<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Chi tiết lớp</title>
    <link rel="stylesheet" th:href="@{/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
<h2 th:text="${clazz.name}">Tên lớp</h2>

<!-- Thông báo (flash hoặc query params) -->
<div th:if="${message}" style="color:green" th:text="${message}"></div>
<div th:if="${errorMessage}" style="color:red" th:text="${errorMessage}"></div>

<div>
    <p><strong>HLV:</strong>
        <span th:text="${trainer != null ? trainer.firstName + ' ' + trainer.lastName : 'N/A'}">Trainer</span>
    </p>
    <p>
        <strong>Sức chứa:</strong>
        <span th:text="${clazz.capacity}">0</span>
        (<span th:text="${currentMembers}">0</span> đã đăng ký)
        <span th:if="${isFull}" style="color:red"> - Đã đủ chỗ</span>
    </p>
    <p><strong>Mô tả:</strong></p>
    <p th:text="${clazz.description}">Không có mô tả</p>
</div>

<!-- Nút đăng ký / hủy đăng ký (frontend control) -->
<div>
    <form th:if="${!isJoined and !isFull and !noFutureSchedules}"
          th:action="@{|/classes/${clazz.id}/register|}" method="post">
        <button type="submit">Đăng ký</button>
    </form>

    <button th:if="${noFutureSchedules}" type="button" disabled
            title="Lớp không còn lịch học trong tương lai">Không thể đăng ký</button>

    <button th:if="${isFull}" type="button" disabled
            title="Lớp đã đủ chỗ">Đã đầy</button>

    <form th:if="${isJoined}" th:action="@{|/classes/${clazz.id}/unregister|}" method="post">
        <button type="submit">Hủy đăng ký</button>
    </form>
</div>


<h3>Lịch (slot 2 giờ)</h3>
<table border="1" cellspacing="0" cellpadding="6">
    <thead>
    <tr>
        <th>Ngày</th>
        <th>Slot</th>
        <th>Giờ</th>
        <th>Trạng thái</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="s : ${schedules}">
        <td th:text="${s.slot.slotDate}">2025-10-14</td>
        <td th:text="${s.slot.slotNumber}">SLOT_1</td>
        <td>
            <span th:text="${s.slot.startTime}">06:00</span>
            -
            <span th:text="${s.slot.endTime}">08:00</span>
        </td>
        <td th:text="${s.status}">CONFIRMED</td>
    </tr>
    <tr th:if="${#lists.isEmpty(schedules)}">
        <td colspan="4">Chưa có lịch</td>
    </tr>
    </tbody>
</table>

<p><a th:href="@{/classes}">&larr; Quay lại danh sách</a></p>

<!-- Chặn click từ frontend (phòng user sửa DOM) -->
<script th:inline="javascript">
    /*<![CDATA[*/
    const isFull = /*[[${isFull}]]*/ false;
    const isJoined = /*[[${isJoined}]]*/ false;

    document.addEventListener('click', function(e) {
        const btn = e.target.closest('button');
        if (!btn) return;

        if (btn.type === 'submit' && btn.textContent.includes('Đăng ký') && isFull) {
            e.preventDefault();
            alert('Lớp đã đủ chỗ');
        }
        if (btn.type === 'submit' && btn.textContent.includes('Hủy đăng ký') && !isJoined) {
            e.preventDefault();
            alert('Bạn chưa tham gia lớp này');
        }
    });
    /*]]>*/
</script>
</body>
</html>
