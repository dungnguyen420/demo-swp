<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>C·ª≠a h√†ng</title>
    <style>
        .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:16px; }
        .card { border:1px solid #e5e5e5; border-radius:8px; padding:12px; background:#fff; display:flex; flex-direction:column; }
        .card img { width:100%; height:160px; object-fit:cover; border-radius:6px; background:#f6f6f6; }
        .name { font-weight:600; margin:8px 0 4px; }
        .price { color:#e03131; font-weight:600; }
        .row { display:flex; gap:8px; align-items:center; justify-content:space-between; margin-top:8px; }
        .actions form { display:flex; gap:6px; align-items:center; }
        .qty { width:64px; text-align:right; }
        .toolbar { display:flex; gap:10px; align-items:center; margin:10px 0 16px; flex-wrap:wrap; }
        .pagination a { margin:0 4px; text-decoration:none; }
        .pagination .current { font-weight:bold; }
    </style>
</head>
<body>

<h2>C·ª≠a h√†ng</h2>

<form class="toolbar" method="get" th:action="@{/shop}">
    <input type="text" name="keyword" placeholder="T√¨m s·∫£n ph·∫©m..." th:value="${keyword}">
    <label>Size:</label>
    <input type="number" name="size" th:value="${size}" min="1" max="100" style="width:80px">
    <label>S·∫Øp x·∫øp:</label>
    <select name="sortBy">
        <option value="name" th:selected="${sortBy=='name'}">T√™n</option>
        <option value="price" th:selected="${sortBy=='price'}">Gi√°</option>
        <option value="quantity" th:selected="${sortBy=='quantity'}">T·ªìn kho</option>
        <option value="id" th:selected="${sortBy=='id'}">M·ªõi nh·∫•t</option>
    </select>
    <select name="dir">
        <option value="asc" th:selected="${dir=='asc'}">TƒÉng d·∫ßn</option>
        <option value="desc" th:selected="${dir=='desc'}">Gi·∫£m d·∫ßn</option>
    </select>
    <button type="submit">√Åp d·ª•ng</button>
    <a th:href="@{/shop(size=${size}, sortBy=${sortBy}, dir=${dir})}">Clear</a>

    <a th:href="@{/cart/view}"
       style="margin-left:auto; position:relative; padding:8px 12px; border:1px solid #ccc; border-radius:6px; text-decoration:none;">
        üõí Gi·ªè h√†ng
        <span th:if="${cartCount != null and cartCount > 0}"
              th:text="${cartCount}"
              style="position:absolute; top:-6px; right:-6px; background:#e03131; color:#fff; border-radius:999px; padding:0 6px; font-size:12px; line-height:18px; min-width:18px; text-align:center;">
    0
  </span>
    </a>
</form>

<div class="grid">
    <div class="card" th:each="p : ${products}">
        <img th:if="${p.image != null}" th:src="${p.image}" alt="image">
        <div class="name" th:text="${p.name}">T√™n s·∫£n ph·∫©m</div>
        <div th:text="${p.description}" style="font-size:13px; color:#555; min-height:36px; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">
            M√¥ t·∫£
        </div>
        <div class="row">
            <div class="price" th:text="${p.price}">0</div>
            <div style="font-size:12px; color:#666">C√≤n: <span th:text="${p.quantity}">0</span></div>
        </div>
        <div class="row actions">
            <form th:action="@{/cart/add}" method="post">
                <input type="hidden" name="productId" th:value="${p.id}">
                <input class="qty" type="number" name="quantity" value="1" min="1" th:attr="max=${p.quantity}">
                <button type="submit" th:disabled="${p.quantity <= 0}">Th√™m v√†o gi·ªè</button>
            </form>
        </div>
    </div>
</div>

<div class="pagination" style="margin-top:16px;" th:if="${totalPages > 0}">
    <a th:if="${page > 0}"
       th:href="@{/shop(page=${0}, size=${size}, sortBy=${sortBy}, dir=${dir}, keyword=${keyword})}">Trang ƒë·∫ßu</a>

    <a th:if="${page > 0}"
       th:href="@{/shop(page=${page -1}, size=${size}, sortBy=${sortBy}, dir=${dir}, keyword=${keyword})}">Tr∆∞·ªõc</a>

    <span th:each="i : ${#numbers.sequence(0, totalPages -1)}">
    <a th:if="${i != page}"
       th:text="${i+1}"
       th:href="@{/shop(page=${i}, size=${size}, sortBy=${sortBy}, dir=${dir}, keyword=${keyword})}">1</a>
    <span th:if="${i == page}" class="current" th:text="${i+1}">1</span>
    <span> </span>
  </span>

    <a th:if="${page < totalPages -1}"
       th:href="@{/shop(page=${page+1}, size=${size}, sortBy=${sortBy}, dir=${dir}, keyword=${keyword})}">Sau</a>

    <a th:if="${page < totalPages -1}"
       th:href="@{/shop(page=${totalPages -1}, size=${size}, sortBy=${sortBy}, dir=${dir}, keyword=${keyword})}">Trang cu·ªëi</a>
</div>

</body>
</html>
